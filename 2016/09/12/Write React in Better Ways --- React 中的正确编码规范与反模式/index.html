<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Write React in Better Ways --- React 中的正确编码规范与反模式 · okiilemon's blog</title><meta name="description" content="Write React in Better Ways --- React 中的正确编码规范与反模式 - okiilemon"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="okiilemon's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">文章列表</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">关于</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Write React in Better Ways --- React 中的正确编码规范与反模式</h1><div class="post-info">Sep 12, 2016</div><div class="post-content"><h4 id="组件的组织方式"><a href="#组件的组织方式" class="headerlink" title="组件的组织方式"></a>组件的组织方式</h4><ol>
<li><p>组件的定义，内部各个部分的书写顺序如下：</p>
<ul>
<li>构造函数 constructor<ul>
<li>状态声明  state</li>
<li>事件绑定函数  event handlers</li>
</ul>
</li>
<li>组件生命周期方法  component lifecycle events</li>
<li>defaultProps</li>
<li>propTypes</li>
</ul>
<a id="more"></a>
</li>
</ol>
<p>示例代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span> (props) &#123;</div><div class="line">    <span class="keyword">super</span>(props);</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">smiling</span>: <span class="literal">false</span> &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">this</span>.setState(&#123;<span class="attr">smiling</span>: !<span class="keyword">this</span>.state.smiling&#125;);</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  componentWillMount () &#123;</div><div class="line">    <span class="comment">// add event listeners (Flux Store, WebSocket, document, etc.)</span></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentDidMount () &#123;</div><div class="line">    <span class="comment">// React.getDOMNode()</span></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentWillUnmount () &#123;</div><div class="line">    <span class="comment">// remove event listeners (Flux Store, WebSocket, document, etc.)</span></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  get smilingMessage () &#123;</div><div class="line">    <span class="keyword">return</span> (<span class="keyword">this</span>.state.smiling) ? <span class="string">"is smiling"</span> : <span class="string">""</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render () &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;div onClick=&#123;this.handleClick&#125;&gt;</div><div class="line">        &#123;this.props.name&#125; &#123;this.smilingMessage&#125;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;,</div><div class="line">&#125;</div><div class="line"></div><div class="line">Person.defaultProps = &#123;</div><div class="line">  <span class="attr">name</span>: <span class="string">'Guest'</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">Person.propTypes = &#123;</div><div class="line">  <span class="attr">name</span>: React.PropTypes.string</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h4 id="格式化-props"><a href="#格式化-props" class="headerlink" title="格式化 props"></a>格式化 props</h4><p>当组件内的 props 大于一个时换行，否则只占一行<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// bad</div><div class="line"><span class="tag">&lt;<span class="name">Person</span></span></div><div class="line"> <span class="attr">firstName</span>=<span class="string">"Michael"</span> /&gt;</div><div class="line"></div><div class="line">// good</div><div class="line"><span class="tag">&lt;<span class="name">Person</span> <span class="attr">firstName</span>=<span class="string">"Michael"</span> /&gt;</span></div><div class="line"></div><div class="line">// bad</div><div class="line"><span class="tag">&lt;<span class="name">Person</span> <span class="attr">firstName</span>=<span class="string">"Michael"</span> <span class="attr">lastName</span>=<span class="string">"Chan"</span> <span class="attr">occupation</span>=<span class="string">"Designer"</span> <span class="attr">favoriteFood</span>=<span class="string">"Drunken Noodles"</span> /&gt;</span></div><div class="line"></div><div class="line">// good</div><div class="line"><span class="tag">&lt;<span class="name">Person</span></span></div><div class="line"> <span class="attr">firstName</span>=<span class="string">"Michael"</span></div><div class="line"> <span class="attr">lastName</span>=<span class="string">"Chan"</span></div><div class="line"> <span class="attr">occupation</span>=<span class="string">"Designer"</span></div><div class="line"> <span class="attr">favoriteFood</span>=<span class="string">"Drunken Noodles"</span> /&gt;</div></pre></td></tr></table></figure></p>
<h4 id="计算-props"><a href="#计算-props" class="headerlink" title="计算 props"></a>计算 props</h4><p>使用 getter 去定义计算的 props<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">firstAndLastName () &#123;</div><div class="line">	<span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.props.firstName&#125;</span> <span class="subst">$&#123;<span class="keyword">this</span>.props.lastname&#125;</span>`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line">get fullName () &#123;</div><div class="line">	<span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.props.firstName&#125;</span> <span class="subst">$&#123;<span class="keyword">this</span>.props.lastname&#125;</span>`</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="复合状态-Compound-State"><a href="#复合状态-Compound-State" class="headerlink" title="复合状态 Compound State"></a>复合状态 Compound State</h4><p>同样使用 getter 去定义并且使用动词前缀以增加可读性<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">happyAndKnowsIt () &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.state.happy &amp;&amp; <span class="keyword">this</span>.state.knowsIt;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// good</span></div><div class="line">get isHappyAndKnowsIt () &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.state.happy &amp;&amp; <span class="keyword">this</span>.state.knowsIt;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这些方法的返回值必须是布尔类型</p>
<h4 id="使用三元表达式而不是嵌套的-render"><a href="#使用三元表达式而不是嵌套的-render" class="headerlink" title="使用三元表达式而不是嵌套的 render"></a>使用三元表达式而不是嵌套的 render</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">renderSmilingStatement () &#123;</div><div class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;(this.state.isSmiling) ? " is smiling." : ""&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span>;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">render () &#123;</div><div class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.name&#125;&#123;this.renderSmilingStatement()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// good</span></div><div class="line">render () &#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">      &#123;this.props.name&#125;</div><div class="line">      &#123;(this.state.smiling)</div><div class="line">        ? <span class="tag">&lt;<span class="name">span</span>&gt;</span>is smiling<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">        : null</div><div class="line">      &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="View-组件"><a href="#View-组件" class="headerlink" title="View 组件"></a>View 组件</h4><p>将各个组件组合成为视图，不要为了将布局和子组件糅合在一起而去定义一个一次性的组件。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="comment">// 这里创建了一个包裹 People 组件的一次性组件</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PeopleWrappedInBSRow</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render () &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"row"</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">People</span> <span class="attr">people</span>=<span class="string">&#123;this.state.people&#125;</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// good</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BSRow</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render () &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"row"</span>&gt;</span>&#123;this.props.children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeView</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render () &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">BSRow</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">People</span> <span class="attr">people</span>=<span class="string">&#123;this.state.people&#125;</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">BSRow</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="容器组件-Container-Components"><a href="#容器组件-Container-Components" class="headerlink" title="容器组件 Container Components"></a>容器组件 Container Components</h4><p>容器组件负责的事情就是获取数据然后渲染对应的子组件</p>
<p>Bad<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// CommentList.js</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  getInitialState () &#123;</div><div class="line">    <span class="keyword">return</span> &#123; <span class="attr">comments</span>: [] &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  componentDidMount () &#123;</div><div class="line">    $.ajax(&#123;</div><div class="line">      <span class="attr">url</span>: <span class="string">"/my-comments.json"</span>,</div><div class="line">      <span class="attr">dataType</span>: <span class="string">'json'</span>,</div><div class="line">      <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">comments</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">comments</span>: comments&#125;);</div><div class="line">      &#125;.bind(<span class="keyword">this</span>)</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render () &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></div><div class="line">        &#123;this.state.comments.map((&#123;body, author&#125;) =&gt; &#123;</div><div class="line">          return <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;body&#125;—&#123;author&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>;</div><div class="line">        &#125;)&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Good<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// CommentList.js</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></div><div class="line">        &#123;this.props.comments.map((&#123;body, author&#125;) =&gt; &#123;</div><div class="line">          return <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;body&#125;—&#123;author&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>;</div><div class="line">        &#125;)&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// CommentListContainer.js</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentListContainer</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  getInitialState () &#123;</div><div class="line">    <span class="keyword">return</span> &#123; <span class="attr">comments</span>: [] &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  componentDidMount () &#123;</div><div class="line">    $.ajax(&#123;</div><div class="line">      <span class="attr">url</span>: <span class="string">"/my-comments.json"</span>,</div><div class="line">      <span class="attr">dataType</span>: <span class="string">'json'</span>,</div><div class="line">      <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">comments</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">comments</span>: comments&#125;);</div><div class="line">      &#125;.bind(<span class="keyword">this</span>)</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render () &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">CommentList</span> <span class="attr">comments</span>=<span class="string">&#123;this.state.comments&#125;</span> /&gt;</span>;</span></div><div class="line">  &#125;</div><div class="line">``` </div><div class="line">#### 在 render 中计算 state </div><div class="line">不要在 render 方法中额外用变量去引用 steate 或 props</div><div class="line">``` JS</div><div class="line">// bad</div><div class="line">render () &#123;</div><div class="line">  let name = `Mrs. $&#123;this.props.name&#125;`;</div><div class="line"></div><div class="line">  return <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// good</div><div class="line">render () &#123;</div><div class="line">  return <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;`Mrs. $&#123;this.props.name&#125;`&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// best</span></div><div class="line">get fancyName () &#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">`Mrs. <span class="subst">$&#123;<span class="keyword">this</span>.props.name&#125;</span>`</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">render () &#123;</div><div class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.fancyName&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="复合条件语句"><a href="#复合条件语句" class="headerlink" title="复合条件语句"></a>复合条件语句</h4><p>避免在 render 方法中使用 if else 语句<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">render () &#123;</div><div class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;if (this.state.happy &amp;&amp; this.state.knowsIt) &#123; return "Clapping hands" &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// better</span></div><div class="line">get isTotesHappy() &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.state.happy &amp;&amp; <span class="keyword">this</span>.state.knowsIt;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">render() &#123;</div><div class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;(this.isTotesHappy) &amp;&amp; "Clapping hands"&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最佳的实践应该是在 container 组件中去管理状态，然后将更新后的状态以 props 的形式传递给子组件</p>
<h4 id="检查某个-props-是否存在"><a href="#检查某个-props-是否存在" class="headerlink" title="检查某个 props 是否存在"></a>检查某个 props 是否存在</h4><p>充分利用 defaultProps , 避免使用 props 对象去检测<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">render () &#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.props.person) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.person.firstName&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// good</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.person.firstName&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">MyComponent.defaultProps = &#123;</div><div class="line">  <span class="attr">person</span>: &#123;</div><div class="line">    <span class="attr">firstName</span>: <span class="string">'Guest'</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="用-props-给-state-赋值"><a href="#用-props-给-state-赋值" class="headerlink" title="用 props 给 state 赋值"></a>用 props 给 state 赋值</h4><p>除了用 state 初始化 props ，其他情况下要避免这样使用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line">getInitialState () &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">items</span>: <span class="keyword">this</span>.props.items</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"><span class="comment">// good</span></div><div class="line">getInitialState () &#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">items</span>: <span class="keyword">this</span>.props.initialItems</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/10/19/hello-world/" class="prev">PREV</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://yoursite.com">okiilemon</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>